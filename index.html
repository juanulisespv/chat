<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat - Uli</title>
  <style>
    /* Estilos Mac OS Classic para el menú superior */
    .mac-menu-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 28px;
      background: linear-gradient(to bottom, #e0e0e0 80%, #b0b0b0 100%);
      border-bottom: 2px solid #000;
      box-shadow: 0 2px 0 #888;
      z-index: 1000;
      display: flex;
      align-items: center;
      font-family: 'Chicago', 'Geneva', Arial, sans-serif;
    }
    .mac-menu {
      display: flex;
      align-items: center;
      height: 100%;
      gap: 18px;
      padding-left: 16px;
    }
    .mac-menu-logo {
      font-size: 18px;
      font-family: 'Geneva', Arial, sans-serif;
      font-weight: bold;
      color: #222;
      margin-right: 10px;
      text-shadow: 1px 1px 0 #fff, 0 0 2px #888;
    }
    .mac-menu-link {
      font-size: 15px;
      color: #222;
      text-decoration: none;
      padding: 2px 10px 2px 10px;
      border-radius: 0;
      transition: color 0.2s;
      border: none;
      box-shadow: none;
      font-weight: bold;
      letter-spacing: 0.5px;
      cursor: pointer;
    }
    .mac-menu-link:hover {
      color: #000;
      text-shadow: 0 0 2px #888, 0 0 1px #fff;
    }
    body {
      background: #c0c0c0;
      font-family: 'Chicago', 'Geneva', Arial, sans-serif;
      margin: 0;
      height: 100vh;
    }
    .mac-window {
      width: 480px;
      min-width: 320px;
      min-height: 220px;
      max-width: 90vw;
      max-height: 90vh;
      position: absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border: 2px solid #000;
      box-shadow: 4px 4px 0 #888;
      border-radius: 6px 6px 0 0;
      resize: both;
      overflow: auto;
      z-index: 10;
    }
    .mac-titlebar {
      cursor: move;
    }
    .mac-titlebar {
      background: linear-gradient(to bottom, #e0e0e0 80%, #b0b0b0 100%);
      border-bottom: 2px solid #000;
      padding: 6px 10px;
      display: flex;
      align-items: center;
      border-radius: 6px 6px 0 0;
    }
    .mac-titlebar .mac-buttons {
      display: flex;
      gap: 4px;
      margin-right: 10px;
    }
    .mac-btn {
      width: 12px;
      height: 12px;
      border: 1.5px solid #000;
      border-radius: 50%;
      background: #fff;
      box-shadow: 1px 1px 0 #888;
      transition: background 0.2s, border-color 0.2s;
      cursor: pointer;
      display: inline-block;
    }
    .mac-btn.close:hover {
      background: #ff5f57;
      border-color: #ff5f57;
    }
    .mac-btn.max:hover {
      background: #28c940;
      border-color: #28c940;
    }
    .mac-btn.min:hover {
      background: #fdbc40;
      border-color: #fdbc40;
    }
    .mac-title {
      font-weight: bold;
      font-size: 16px;
      flex: 1;
      text-align: center;
      letter-spacing: 1px;
    }
    .mac-content {
      padding: 18px 16px 16px 16px;
    }
    .mac-label {
      font-size: 13px;
      margin-bottom: 8px;
      display: block;
    }
    .mac-input, .mac-btn-main {
      font-family: inherit;
      font-size: 13px;
      border: 2px solid #000;
      background: #e0e0e0;
      padding: 4px 8px;
      margin-bottom: 10px;
      border-radius: 3px;
    }
    .mac-btn-main {
      cursor: pointer;
      font-weight: bold;
      box-shadow: 2px 2px 0 #888;
    }
    #chatContainer {
      background: #f8f8f8;
      border: 1.5px solid #000;
      min-height: 120px;
      padding: 10px;
      font-size: 13px;
      margin-top: 12px;
      border-radius: 3px;
      box-shadow: 2px 2px 0 #888;
    }
  </style>
</head>
<body>
  <div class="mac-menu-bar">
    <div class="mac-menu">
      <span class="mac-menu-logo"></span>
      <a href="#" class="mac-menu-link" onclick="openWindow('chat')">Chat</a>
      <a href="#" class="mac-menu-link" onclick="openWindow('cv')">CV</a>
      <a href="#" class="mac-menu-link" onclick="openWindow('proyectos')">Proyectos</a>
      <a href="#" class="mac-menu-link" onclick="openWindow('contacto')">Contacto</a>
    </div>
    <div id="mac-clock" style="margin-left:auto; margin-right:18px; font-size:15px; color:#222; font-weight:bold; letter-spacing:1px; text-shadow:0 0 2px #fff;">
      <!-- La fecha y hora aparecerán aquí -->
    </div>
  </div>
  <div class="mac-window" id="chat-window">
    <div class="mac-titlebar">
      <div class="mac-buttons">
        <div class="mac-btn close" title="Cerrar"></div>
        <div class="mac-btn min" title="Minimizar"></div>
        <div class="mac-btn max" title="Maximizar"></div>
      </div>
      <div class="mac-title">Chat - Uli</div>
    </div>
    <div class="mac-content">
      <!--
      <form id="pdfForm">
        <label for="pdfFile" class="mac-label">Selecciona un PDF:</label>
        <input type="file" id="pdfFile" accept="application/pdf" class="mac-input">
        <br>
        <button type="submit" class="mac-btn-main" style="display:inline-block;">Enviar PDF</button>
      </form>
      -->
      <div id="chatContainer"></div>
      <form id="chatForm" style="margin-top:14px; display:flex; gap:8px;">
        <input type="text" id="chatInput" class="mac-input" placeholder="Escribe tu pregunta..." style="flex:1;">
        <button type="submit" class="mac-btn-main">Enviar</button>
      </form>
    </div>
  </div>
  <!-- <script src="main.js"></script> -->
  <script>
  // Actualizar la fecha y hora en el menú superior
  function updateClock() {
    const now = new Date();
    const options = { weekday: 'short', day: '2-digit', month: 'short', year: 'numeric' };
    const dateStr = now.toLocaleDateString('es-ES', options);
    const timeStr = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    document.getElementById('mac-clock').textContent = `${dateStr} ${timeStr}`;
  }
  setInterval(updateClock, 1000);
  updateClock();

  // Funcionalidad de los botones de ventana
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.mac-window').forEach(win => {
      const closeBtn = win.querySelector('.mac-btn.close');
      const maxBtn = win.querySelector('.mac-btn.max');
      const minBtn = win.querySelector('.mac-btn.min');
      if (closeBtn) {
        closeBtn.addEventListener('click', function(e) {
          win.style.display = 'none';
        });
      }
      if (maxBtn) {
        let maximized = false;
        maxBtn.addEventListener('click', function(e) {
          const content = win.querySelector('.mac-content');
          if (!maximized) {
            win.style.width = '90vw';
            win.style.height = '90vh';
            win.style.top = '5vh';
            win.style.left = '50%';
            win.style.transform = 'translateX(-50%)';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            if (content) content.style.display = '';
            maximized = true;
          } else {
            win.style.width = '';
            win.style.height = '';
            win.style.top = '40px';
            win.style.left = '50%';
            win.style.transform = 'translateX(-50%)';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            if (content) content.style.display = '';
            maximized = false;
          }
        });
      }
      if (minBtn) {
        let minimized = false;
        minBtn.addEventListener('click', function(e) {
          const content = win.querySelector('.mac-content');
          const titlebar = win.querySelector('.mac-titlebar');
          if (!minimized) {
            if (content) content.style.display = 'none';
            win.style.height = (titlebar.offsetHeight + 4) + 'px';
            win.style.width = (titlebar.offsetWidth + 8) + 'px';
            win.style.background = 'transparent';
            win.style.border = 'none';
            win.style.borderRadius = '6px';
            win.style.boxShadow = 'none';
            minimized = true;
          } else {
            if (content) content.style.display = '';
            win.style.height = '';
            win.style.width = '';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            win.style.boxShadow = '4px 4px 0 #888';
            minimized = false;
          }
        });
      }
    });
  });
  // Abrir ventanas simuladas
  window.openWindow = function(type) {
    // No ocultar ninguna ventana, solo abrir la nueva o mostrar la existente
    if (type === 'chat') {
      document.getElementById('chat-window').style.display = 'block';
      return;
    }
    let win = document.getElementById(type + '-window');
    if (!win) {
      win = document.createElement('div');
      win.className = 'mac-window';
      win.id = type + '-window';
      // Posición aleatoria
      const randTop = Math.floor(Math.random() * 40) + 40; // entre 40px y 80px
      const randLeft = Math.floor(Math.random() * (window.innerWidth - 500)) + 40; // entre 40px y ancho-500
  win.style.top = randTop + 'px';
  win.style.left = randLeft + 'px';
  win.style.width = '700px';
  win.style.transform = '';
      let title = '';
      let content = '';
  if (type === 'cv') {
    title = 'CV';
  content = `<div style="padding:18px 24px; max-width: 750px; font-family: 'Geneva', Arial, sans-serif; font-size: 15px; line-height: 1.7; background: #f7f7f7; border-radius: 8px; box-shadow: 0 2px 8px #0001;">
<div style="font-size:22px; font-weight:bold; margin-bottom:2px; color:#222;">Juan Ulises Pérez Visairas</div>
<div style="font-size:16px; color:#555; margin-bottom:8px;">Profesional en marketing, comunicación y desarrollo tecnológico</div>
<div style="font-size:13px; color:#666; margin-bottom:18px;">Florida 17 2ºD. 01005. Vitoria, Spain · (+34) 693 80 50 23 · juanulisespv@gmail.com</div>

<div style="margin-bottom:16px;"><span style="font-weight:bold; color:#222;">Perfil</span><br>
<span style="color:#333;">Profesional creativo con sólida experiencia en marketing y estrategia digital, actualmente enfocado en el desarrollo tecnológico. Apasionado por aprender, construir y colaborar. Busco contribuir en entornos donde la innovación, la comunicación y la tecnología se encuentran para generar un impacto real.</span></div>

<div style="margin-bottom:16px;"><span style="font-weight:bold; color:#222;">Experiencia</span><ul style="margin:6px 0 0 18px; padding:0;">
<li><b>Formador en E-commerce, Cruz Roja</b> <span style="color:#888;">(Jun 2025)</span><br><span style="color:#333;">Curso de 100h sobre competencias digitales. Diseño de materiales, seguimiento del alumnado y evaluación.</span></li>
<li><b>Marketing Manager, DAISALUX</b> <span style="color:#888;">(Oct 2016 – May 2025)</span><br><span style="color:#333;">Lanzamientos de producto, SEO, SEM, contenidos web, RRSS, gestión de proyectos con agencia y coordinación con I+D.</span></li>
<li><b>Project Manager, EXPONENCIAL</b> <span style="color:#888;">(Mar 2012 – Sep 2016)</span><br><span style="color:#333;">Desarrollo de webs y ecommerce, diseño de contenido y asesoramiento en marketing.</span></li>
<li><b>Comunicación, MERCEDES BENZ</b> <span style="color:#888;">(Ene 2011 – Ene 2012)</span><br><span style="color:#333;">Soporte en comunicación, diseño gráfico y eventos corporativos.</span></li>
<li><b>Marketing y Ventas, ABGAM</b> <span style="color:#888;">(Oct 2009 – Ene 2011)</span><br><span style="color:#333;">Marketing digital y campañas con Dassault Systèmes.</span></li>
<li><b>Proyectos de comunicación, PRISMAGLOBAL</b> <span style="color:#888;">(Mar 2008 – Jun 2009)</span><br><span style="color:#333;">Captación de leads y planes estratégicos de marketing.</span></li>
</ul></div>

<div style="margin-bottom:16px;"><span style="font-weight:bold; color:#222;">Educación</span><ul style="margin:6px 0 0 18px; padding:0;">
<li>Grado en Ingeniería Informática – EUNIV <span style="color:#888;">(en curso, 120 créditos restantes)</span></li>
<li>Licenciatura en Publicidad y Relaciones Públicas – Universidad Nebrija</li>
<li>MBA en Marketing, Comunicación y Ventas – ESDEN</li>
<li>FP2 Desarrollo de Aplicaciones Web (Bilingüe) – ICjardin</li>
<li>Máster en Creatividad Publicitaria – Aula Creactiva</li>
</ul></div>

<div style="margin-bottom:16px;"><span style="font-weight:bold; color:#222;">Certificaciones</span><ul style="margin:6px 0 0 18px; padding:0;">
<li>Google Ads y Google Analytics</li>
<li>Marketing y Comercio Internacional – IE</li>
<li>Marketing Internacional – Cambridge</li>
<li>Marketing Digital y Ecommerce – CETIC</li>
<li>Diseño Gráfico y Web – Trazos</li>
</ul></div>

<div style="margin-bottom:16px;"><span style="font-weight:bold; color:#222;">Habilidades Técnicas</span><ul style="margin:6px 0 0 18px; padding:0;">
<li>JavaScript, Python, PHP, SQL, HTML5, CSS3</li>
<li>WordPress, Prestashop</li>
<li>Marketing digital, IA, tecnologías emergentes</li>
<li>Canva, Office, Adobe Creative Suite</li>
</ul></div>

<div style="margin-bottom:16px;"><span style="font-weight:bold; color:#222;">Idiomas</span><ul style="margin:6px 0 0 18px; padding:0;">
<li>Español: Nativo</li>
<li>Inglés: Nivel C1 (prácticas universitarias en EE.UU.)</li>
</ul></div>

<div style="margin-bottom:8px;"><span style="font-weight:bold; color:#222;">Información Adicional</span><ul style="margin:6px 0 0 18px; padding:0;">
<li>Interesado en trabajo remoto</li>
<li>Disponible para viajar</li>
<li>Licencia de conducir y coche propio</li>
</ul></div>
</div>`;
  } else if (type === 'proyectos') {
        title = 'Proyectos';
        content = '<div style="padding:16px;">Aquí se mostrarán los proyectos.<br><br><a href="https://github.com/juanulisespv" target="_blank">Ver proyectos en GitHub</a></div>';
      } else if (type === 'contacto') {
        title = 'Contacto';
        content = '<div style="padding:16px;">Puedes contactar a Uli en:<br><br><a href="mailto:uli@email.com">uli@email.com</a></div>';
      }
      win.innerHTML = `
        <div class="mac-titlebar">
          <div class="mac-buttons">
            <div class="mac-btn close" title="Cerrar"></div>
            <div class="mac-btn min" title="Minimizar"></div>
            <div class="mac-btn max" title="Maximizar"></div>
          </div>
          <div class="mac-title">${title}</div>
        </div>
        <div class="mac-content">${content}</div>
      `;
      document.body.appendChild(win);
      // Añadir funcionalidad a los botones de la ventana nueva
      const closeBtn = win.querySelector('.mac-btn.close');
      const maxBtn = win.querySelector('.mac-btn.max');
      const minBtn = win.querySelector('.mac-btn.min');
      let maximized = false;
      let minimized = false;
      if (closeBtn) {
        closeBtn.addEventListener('click', function(e) {
          win.style.display = 'none';
        });
      }
      if (maxBtn) {
        maxBtn.addEventListener('click', function(e) {
          const content = win.querySelector('.mac-content');
          if (!maximized) {
            win.style.width = '90vw';
            win.style.height = '90vh';
            win.style.top = '5vh';
            win.style.left = '50%';
            win.style.transform = 'translateX(-50%)';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            win.style.boxShadow = '4px 4px 0 #888';
            if (content) content.style.display = '';
            maximized = true;
          } else {
            win.style.width = '';
            win.style.height = '';
            win.style.top = randTop + 'px';
            win.style.left = randLeft + 'px';
            win.style.transform = '';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            win.style.boxShadow = '4px 4px 0 #888';
            if (content) content.style.display = '';
            maximized = false;
          }
        });
      }
      if (minBtn) {
        minBtn.addEventListener('click', function(e) {
          const content = win.querySelector('.mac-content');
          const titlebar = win.querySelector('.mac-titlebar');
          if (!minimized) {
            if (content) content.style.display = 'none';
            win.style.height = (titlebar.offsetHeight + 4) + 'px';
            win.style.width = (titlebar.offsetWidth + 8) + 'px';
            win.style.background = 'transparent';
            win.style.border = 'none';
            win.style.borderRadius = '6px';
            win.style.boxShadow = 'none';
            minimized = true;
          } else {
            if (content) content.style.display = '';
            win.style.height = '';
            win.style.width = '';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            win.style.boxShadow = '4px 4px 0 #888';
            minimized = false;
          }
        });
      }
      makeWindowDraggable(win);
    }
    win.style.display = 'block';
  };
  // Mostrar ventana de chat al inicio
  window.addEventListener('DOMContentLoaded', function() {
    openWindow('chat');
  });
  // Hacer la ventana movible y escalable
  // Hacer todas las ventanas movibles
  function makeWindowDraggable(win) {
    const bar = win.querySelector('.mac-titlebar');
    if (!bar) return;
    let isDragging = false, startX = 0, startY = 0, startLeft = 0, startTop = 0;
    bar.addEventListener('mousedown', function(e) {
      isDragging = true;
      startX = e.clientX;
      startY = e.clientY;
      const rect = win.getBoundingClientRect();
      startLeft = rect.left;
      startTop = rect.top;
      document.body.style.userSelect = 'none';
    });
    document.addEventListener('mousemove', function(e) {
      if (!isDragging) return;
      let dx = e.clientX - startX;
      let dy = e.clientY - startY;
      win.style.left = (startLeft + dx) + 'px';
      win.style.top = (startTop + dy) + 'px';
      win.style.transform = '';
    });
    document.addEventListener('mouseup', function() {
      isDragging = false;
      document.body.style.userSelect = '';
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.mac-window').forEach(makeWindowDraggable);
  });

  // Chat clásico Mac OS
  const chatForm = document.getElementById('chatForm');
  const chatInput = document.getElementById('chatInput');
  const chatContainer = document.getElementById('chatContainer');

  // Mensaje inicial
  window.addEventListener('DOMContentLoaded', function() {
    addMessage('assistant', 'Hola, Soy Uli, experto en Marketing y Desarrollo Tecnológico, ¿cómo puedo ayudarte?');
  });

  chatForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    const pregunta = chatInput.value.trim();
    if (!pregunta) return;
    chatInput.value = '';
    // Mostrar pregunta en el chat
    addMessage('user', pregunta);
    // Enviar pregunta al backend
    const res = await fetch('/api/consultar', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ pregunta })
    });
    const data = await res.json();
    if (data.respuesta) {
      addMessage('assistant', data.respuesta);
    } else {
      addMessage('assistant', 'Error: No se obtuvo respuesta.');
    }
  });

  function addMessage(role, text) {
    const msgDiv = document.createElement('div');
    msgDiv.className = 'mac-msg ' + role;
    msgDiv.textContent = text;
    chatContainer.appendChild(msgDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  // Estilos para los mensajes
  const style = document.createElement('style');
  style.textContent = `
    .mac-msg {
      margin: 6px 0;
      padding: 7px 12px;
      border-radius: 4px;
      font-size: 13px;
      max-width: 90%;
      box-shadow: 1px 1px 0 #bbb;
    }
    .mac-msg.user {
      background: #e0e0e0;
      border: 1px solid #888;
      text-align: right;
      margin-left: auto;
    }
    .mac-msg.assistant {
      background: #e0e0e0;
      border: 1px solid #888;
      text-align: left;
      margin-right: auto;
    }
  `;
  document.head.appendChild(style);
  </script>
</body>
</html>
