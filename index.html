<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat - Uli</title>
  <style>
    /* Estilos Mac OS Classic para el menú superior */
    .mac-menu-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 28px;
      background: linear-gradient(to bottom, #e0e0e0 80%, #b0b0b0 100%);
      border-bottom: 2px solid #000;
      box-shadow: 0 2px 0 #888;
      z-index: 1000;
      display: flex;
      align-items: center;
      font-family: 'Chicago', 'Geneva', Arial, sans-serif;
    }
    .mac-menu {
      display: flex;
      align-items: center;
      height: 100%;
      gap: 18px;
      padding-left: 16px;
    }
    .mac-menu-logo {
      font-size: 18px;
      font-family: 'Geneva', Arial, sans-serif;
      font-weight: bold;
      color: #222;
      margin-right: 10px;
      text-shadow: 1px 1px 0 #fff, 0 0 2px #888;
    }
    .mac-menu-link {
      font-size: 15px;
      color: #222;
      text-decoration: none;
      padding: 2px 10px 2px 10px;
      border-radius: 0;
      transition: color 0.2s;
      border: none;
      box-shadow: none;
      font-weight: bold;
      letter-spacing: 0.5px;
      cursor: pointer;
    }
    .mac-menu-link:hover {
      color: #000;
      text-shadow: 0 0 2px #888, 0 0 1px #fff;
    }
    body {
      background: #c0c0c0;
      font-family: 'Chicago', 'Geneva', Arial, sans-serif;
      margin: 0;
      height: 100vh;
    }
    .mac-window {
      width: 480px;
      min-width: 320px;
      min-height: 220px;
      max-width: 90vw;
      max-height: 90vh;
      position: absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border: 2px solid #000;
      box-shadow: 4px 4px 0 #888;
      border-radius: 6px 6px 0 0;
      resize: both;
      overflow: auto;
      z-index: 10;
    }
    .mac-titlebar {
      cursor: default;
    }
    .mac-titlebar {
      background: linear-gradient(to bottom, #e0e0e0 80%, #b0b0b0 100%);
      border-bottom: 2px solid #000;
      padding: 6px 10px;
      display: flex;
      align-items: center;
      border-radius: 6px 6px 0 0;
      position: relative;
    }
    .mac-titlebar .mac-buttons {
      display: flex;
      gap: 4px;
      margin-right: 10px;
    }
    /* Área de arrastre específica */
    .mac-drag-handle {
      position: absolute;
      top: 0;
      right: 0;
      width: 50px;
      height: 100%;
      cursor: move;
      background: transparent;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .mac-drag-handle:hover {
      background: rgba(255,255,255,0.1);
    }
    .mac-drag-handle::before {
      content: '';
      width: 16px;
      height: 10px;
      background-image: 
        linear-gradient(90deg, #555 0px, #555 15px, transparent 2px, transparent 15px),
        linear-gradient(90deg, #555 0px, #555 15px, transparent 2px, transparent 15px),
        linear-gradient(90deg, #555 0px, #555 15px, transparent 2px, transparent 15px),
        linear-gradient(90deg, #555 0px, #555 15px, transparent 2px, transparent 15px);
      background-size: 16px 1px;
      background-position: 0 0, 0 3px, 0 6px, 0 9px;
      background-repeat: repeat-x, repeat-x, repeat-x, repeat-x;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    .mac-drag-handle:hover::before {
      opacity: 1;
    }
    .mac-btn {
      width: 12px;
      height: 12px;
      border: 1.5px solid #000;
      border-radius: 50%;
      background: #e0e0e0;
      box-shadow: 1px 1px 0 #888;
      cursor: pointer;
      display: inline-block;
    }
    .mac-title {
      font-weight: bold;
      font-size: 16px;
      flex: 1;
      text-align: center;
      letter-spacing: 1px;
    }
    .mac-content {
      padding: 18px 16px 16px 16px;
    }
    .mac-label {
      font-size: 13px;
      margin-bottom: 8px;
      display: block;
    }
    .mac-input, .mac-btn-main {
      font-family: inherit;
      font-size: 13px;
      border: 2px solid #000;
      background: #e0e0e0;
      padding: 4px 8px;
      margin-bottom: 10px;
      border-radius: 3px;
    }
    .mac-input:focus-visible {
      outline: none;
      background: #f5f5f5;
      border-color: #666;
    }
    .mac-btn-main {
      cursor: pointer;
      font-weight: bold;
      box-shadow: 2px 2px 0 #888;
    }
    #chatContainer {
      background: #f8f8f8;
      border: 1.5px solid #000;
      min-height: 120px;
      padding: 10px;
      font-size: 13px;
      margin-top: 12px;
      border-radius: 3px;
      box-shadow: 2px 2px 0 #888;
    }
    .mac-msg {
      margin: 6px 0;
      padding: 7px 12px;
      border-radius: 4px;
      font-size: 13px;
      max-width: 90%;
      box-shadow: 1px 1px 0 #bbb;
    }
    .mac-msg.user {
      background: #e0e0e0;
      border: 1px solid #888;
      text-align: right;
      margin-left: auto;
    }
    .mac-msg.assistant {
      background: #e0e0e0;
      border: 1px solid #888;
      text-align: left;
      margin-right: auto;
    }
    .mac-msg.typing {
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="mac-menu-bar">
    <div class="mac-menu">
      <span class="mac-menu-logo"></span>
      <a href="#" class="mac-menu-link" onclick="openWindow('chat')">Chat</a>
      <a href="#" class="mac-menu-link" onclick="openWindow('cv')">CV</a>
      <a href="#" class="mac-menu-link" onclick="openWindow('proyectos')">Proyectos</a>
      <a href="#" class="mac-menu-link" onclick="openWindow('contacto')">Contacto</a>
    </div>
    <div id="mac-clock" style="margin-left:auto; margin-right:18px; font-size:15px; color:#222; font-weight:bold; letter-spacing:1px; text-shadow:0 0 2px #fff;">
      <!-- La fecha y hora aparecerán aquí -->
    </div>
  </div>
  <div class="mac-window" id="chat-window">
    <div class="mac-titlebar">
      <div class="mac-buttons">
        <div class="mac-btn close" title="Cerrar"></div>
        <div class="mac-btn min" title="Minimizar"></div>
        <div class="mac-btn max" title="Maximizar"></div>
      </div>
      <div class="mac-title">Chat - Uli</div>
    </div>
    <div class="mac-content">
      <!--
      <form id="pdfForm">
        <label for="pdfFile" class="mac-label">Selecciona un PDF:</label>
        <input type="file" id="pdfFile" accept="application/pdf" class="mac-input">
        <br>
        <button type="submit" class="mac-btn-main" style="display:inline-block;">Enviar PDF</button>
      </form>
      -->
      <div id="chatContainer"></div>
      <form id="chatForm" style="margin-top:14px; display:flex; gap:8px;">
        <input type="text" id="chatInput" class="mac-input" placeholder="Escribe tu pregunta..." style="flex:1;">
        <button type="submit" class="mac-btn-main">Enviar</button>
      </form>
    </div>
  </div>
  <!-- <script src="main.js"></script> -->
  <script>
  // Actualizar la fecha y hora en el menú superior
  function updateClock() {
    const now = new Date();
    const options = { weekday: 'short', day: '2-digit', month: 'short', year: 'numeric' };
    const dateStr = now.toLocaleDateString('es-ES', options);
    const timeStr = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    document.getElementById('mac-clock').textContent = `${dateStr} ${timeStr}`;
  }
  setInterval(updateClock, 1000);
  updateClock();

  // Funcionalidad de los botones de ventana
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.mac-window').forEach(win => {
      const closeBtn = win.querySelector('.mac-btn.close');
      const maxBtn = win.querySelector('.mac-btn.max');
      const minBtn = win.querySelector('.mac-btn.min');
      if (closeBtn) {
        closeBtn.addEventListener('click', function(e) {
          win.style.display = 'none';
        });
      }
      if (maxBtn) {
        let maximized = false;
        maxBtn.addEventListener('click', function(e) {
          const content = win.querySelector('.mac-content');
          if (!maximized) {
            win.style.width = '90vw';
            win.style.height = '90vh';
            win.style.top = '5vh';
            win.style.left = '50%';
            win.style.transform = 'translateX(-50%)';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            if (content) content.style.display = '';
            maximized = true;
          } else {
            win.style.width = '';
            win.style.height = '';
            win.style.top = '40px';
            win.style.left = '50%';
            win.style.transform = 'translateX(-50%)';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            if (content) content.style.display = '';
            maximized = false;
          }
        });
      }
      if (minBtn) {
        let minimized = false;
        minBtn.addEventListener('click', function(e) {
          const content = win.querySelector('.mac-content');
          const titlebar = win.querySelector('.mac-titlebar');
          if (!minimized) {
            if (content) content.style.display = 'none';
            win.style.height = (titlebar.offsetHeight + 4) + 'px';
            win.style.width = (titlebar.offsetWidth + 8) + 'px';
            win.style.background = 'transparent';
            win.style.border = 'none';
            win.style.borderRadius = '6px';
            win.style.boxShadow = 'none';
            minimized = true;
          } else {
            if (content) content.style.display = '';
            win.style.height = '';
            win.style.width = '';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            win.style.boxShadow = '4px 4px 0 #888';
            minimized = false;
          }
        });
      }
    });
  });

// Función para generar HTML del CV desde datos embebidos
async function generateCVContent() {
  // Datos del CV embebidos directamente
  const cvData = {
    "nombre": "Juan Ulises Pérez Visairas",
    "subtitulo": "Prólogo: Quién es este tipo y por qué debería importarte",
    "prologo": "Soy Juan Ulises (mis amigos me dicen Uli, y espero que después de leer esto tú también), un vitoriano del 83 que ha decidido que la vida es demasiado corta para hacer solo una cosa bien. Profesionalmente soy esa rara especie que vive en la intersección entre el marketing, la comunicación y el desarrollo tecnológico.\n\nPersonalmente soy el típico que siempre está aprendiendo algo nuevo, entrenando para algo, o planeando el próximo viaje.\n\nMi filosofía es simple: si algo me da curiosidad, me meto de cabeza. Esto me ha llevado a trabajar en empresas como Mercedes Benz o en StartUps, de hacer campañas de marketing a programar aplicaciones web, y de competir en triatlones a intentar no hacer el ridículo surfeando.",
    "contacto": {
      "ubicacion": "Vitoria, España (nacido en 1983)",
      "email": "juanulisespv@gmail.com",
      "disponibilidad": "Trabajo remoto preferido, disponible para viajar, licencia de conducir y coche propio"
    },
    "formacion": {
      "titulo": "Capítulo 1: Los Años de Formación (o Cómo Acabé Siendo Esto)",
      "descripcion": "Todo empezó con una Licenciatura en Publicidad y Relaciones Públicas en la Universidad Nebrija, porque pensaba que ser creativo era genial (y sigue siéndolo). Luego vino un MBA en Dirección de Marketing, Comunicación Empresarial y Ventas en ESDEN, porque alguien me dijo que también era importante entender de números.\n\nPero aquí viene la parte divertida: después de años trabajando en marketing digital, decidí que quería entender qué pasaba 'detrás del telón'. Así que me apunté a un FP en Desarrollo de Aplicaciones Web bilingüe en ICjardin. Fue intenso, no voy a mentir, pero aprendí muchísimo y esa sensación de dominar algo completamente nuevo me enganchó para siempre.\n\nAún con sed de conocimiento, actualmente estoy a punto de acabar un Grado en Ingeniería Informática en EUNIV. Sí, a veces sufro entre algoritmos y estructuras de datos, pero cada concepto que domino me emociona como un niño en una tienda de caramelos. Es esa mezcla de desafío y satisfacción que solo entienden los que han decidido estudiar programación después de los 30.",
      "certificaciones": "Google Ads, Google Analytics, Marketing Internacional de Cambridge, y varias más que probablemente olvide mencionar en entrevistas importantes"
    },
    "experiencia": {
      "titulo": "Capítulo 2: La Odisea Profesional (Con Más Plot Twists que una Serie de Netflix)",
      "trabajos": [
        {
          "puesto": "Formador en E-commerce",
          "empresa": "Cruz Roja",
          "periodo": "Jun 2025",
          "descripcion": "Acabo de terminar un curso de 100 horas sobre competencias digitales donde ayudé a personas a superar el miedo a internet y a vender online sin que les saliera humo del ordenador. Fue muy gratificante ver cómo alguien pasa de '¿qué es un dominio?' a montar su tienda online. Un mes intenso, pero de esos que te recuerdan por qué me fascina la educación y enseñar lo que sé. Y no, no he cerrado esa puerta: la docencia tiene algo especial que me engancha."
        },
        {
          "puesto": "Marketing Manager",
          "empresa": "DAISALUX",
          "periodo": "Oct 2016 – May 2025",
          "descripcion": "Casi 9 años coordinando lanzamientos de producto, optimizando SEO (persiguiendo al señor Google), gestionando SEM (pagándole al señor Google), creando contenidos web, manejando redes sociales, y siendo el puente entre el departamento de I+D y las agencias de marketing. Aquí aprendí que 'para ayer' es realmente una unidad de tiempo válida y que 'solo es un cambio pequeño' nunca, JAMÁS, es un cambio pequeño."
        },
        {
          "puesto": "Project Manager",
          "empresa": "EXPONENCIAL",
          "periodo": "Mar 2012 – Sep 2016",
          "descripcion": "Cuatro años desarrollando webs y ecommerce, diseñando contenido y asesorando en marketing digital. Esta época fue cuando descubrí que me gustaba tanto la parte técnica como la creativa. Era como ser traductor entre programadores y marketers, que básicamente hablan idiomas completamente diferentes."
        },
        {
          "puesto": "Comunicación",
          "empresa": "Mercedes Benz",
          "periodo": "Ene 2011 – Ene 2012",
          "descripcion": "Soporte en comunicación, diseño gráfico y eventos corporativos (donde confirmé que los coches alemanes son tan precisos como dicen)."
        },
        {
          "puesto": "Marketing y Ventas",
          "empresa": "ABGAM",
          "periodo": "Oct 2009 – Ene 2011",
          "descripcion": "Marketing digital con Dassault Systèmes (donde descubrí que el software industrial también necesita marketing)."
        },
        {
          "puesto": "Proyectos de comunicación",
          "empresa": "PRISMAGLOBAL",
          "periodo": "Mar 2008 – Jun 2009",
          "descripcion": "Captación de leads y planes estratégicos (donde aprendí que no todos los leads son buenos leads)."
        }
      ]
    },
    "habilidades": {
      "titulo": "Capítulo 3: Arsenal de Habilidades (o Mi Caja de Herramientas Digital)",
      "lenguajes": "JavaScript, Python, PHP, SQL, HTML5, CSS3, React, Next.js, Node.js - mi stack completo de programador full stack. También trabajo con APIs de IA como OpenAI y Gemini, porque el futuro ya está aquí y hay que subirse al tren. Algunos los manejo mejor que otros, pero todos con cariño y capacidad tanto para frontend como backend.",
      "plataformas": "WordPress, Prestashop, y prácticamente cualquier CMS que me pongas delante.",
      "herramientas": "Marketing digital, IA, tecnologías emergentes, Canva, Office, Adobe Creative Suite. Soy de los que cree que la herramienta no hace al profesional, pero tener buenas herramientas ayuda bastante.",
      "idiomas": "Español nativo, Inglés nivel C1 (confirmado tras prácticas universitarias en EE.UU. donde sobreviví pidiendo comida y entendiendo las clases)."
    },
    "personal": {
      "titulo": "Capítulo 4: La Vida Fuera de la Pantalla",
      "deportes": "Durante años fui triatleta. De esos que se levantan a las 6 AM para entrenar antes de trabajar y que piensan que 'más es mejor'. Hasta que mi cuerpo me enseñó que también tiene voz y voto en estas decisiones. Ahora soy más inteligente: entreno, corro, monto en bici, nado y surfeo, pero escuchando más al cuerpo y menos al ego. El running sigue siendo mi gran pasión deportiva - hay algo terapéutico en salir a correr que nunca me cansa. El surf me gusta y lo disfruto, pero seamos honestos: nada supera la sensación de una buena carrera, ya sea por montaña o por la costa.",
      "musica": "Mi Spotify es un caos organizado: rock clásico para los días épicos, indie alternativo para el flow creativo, Foo Fighters para el gym, LoFi suave para relajarme y concentrarme, y sí, algo de electrónica cuando toca programar hasta tarde. Las bandas sonoras de películas son mi secreto para el trabajo profundo: transforman cualquier tarea en una misión épica.",
      "viajes": "Disfruto igual subiendo una montaña en los Pirineos que tomándome un café en una terraza de Lisboa. Mi pareja y yo somos bastante activos viajando, aunque ella probablemente sea más rápida subiendo cuestas (dato que jamás admitiré públicamente). Mi checklist de viaje perfecto: naturaleza, buena comida local, posibilidad de hacer deporte, y conexión a internet decente por si surge algo de trabajo.",
      "curiosidades": [
        "Ex-bloguero: Mantuve un blog con más de 1000 seguidores donde escribía sobre marketing, tecnología y proyectos personales. Era mi forma de procesar lo que aprendía y ayudar a otros en situaciones similares. Ahora está en hibernación y los seguidores... bueno, quién sabe dónde estarán, pero fue una excelente época de compartir conocimiento.",
        "Chef de supervivencia: Cocino rápido y saludable, que es mi manera diplomática de decir que hago milagros con cuatro ingredientes y poco tiempo. Mis especialidades son 'fusión de lo que hay en la nevera' y 'pasta con lo que encontré en el mercado'.",
        "Coleccionista musical: Me encanta descubrir música nueva y redescubrir clásicos. Siempre estoy explorando géneros, artistas emergentes y esas joyas ocultas que hacen que valga la pena tener buenas playlist.",
        "Early adopter compulsivo: Pruebo apps y herramientas nuevas constantemente. Mi teléfono es un cementerio de aplicaciones que 'iban a revolucionar mi productividad'."
      ]
    },
    "epilogo": {
      "busco": "Proyectos donde pueda combinar creatividad y tecnología, donde el aprendizaje sea constante y donde el impacto sea real. Me motivan los equipos diversos, los retos complejos y las empresas que entienden que la innovación viene de conectar mundos aparentemente diferentes. También me apasiona la educación y la formación, así que siempre estoy abierto a oportunidades donde pueda enseñar y compartir conocimiento.",
      "ofrezco": "Experiencia real, curiosidad infinita, esa rara habilidad de traducir entre departamentos que hablan idiomas diferentes, y una genuina pasión por educar y formar. Soy el tipo que puede explicar conceptos técnicos complejos a marketers y estrategias de marketing a programadores, sin que nadie acabe frustrado.",
      "garantia": "Humor incluido, curiosidad ilimitada, y un nivel de energía que se mantiene bastante bien sin necesidad de litros de café.",
      "contacto_final": "P.D.: Si has llegado hasta aquí, probablemente tengamos cosas en común. Escríbeme y hablemos de proyectos, tecnología, marketing, deportes, música, o de cualquier cosa interesante que se te ocurra."
    }
  };


    
    // Generar HTML para la experiencia
    const experienciaHTML = cvData.experiencia.trabajos.map(exp => 
      `<li><b>${exp.puesto}, ${exp.empresa}</b> <span style="color:#888;">(${exp.periodo})</span><br><span style="color:#333;">${exp.descripcion}</span></li>`
    ).join('');
    
    // Generar HTML para curiosidades
    const curiosidadesHTML = cvData.personal.curiosidades.map(curiosidad => 
      `<li>${curiosidad}</li>`
    ).join('');
    
    return `<div style="padding:18px 24px; max-width: 800px; font-family: 'Geneva', Arial, sans-serif; font-size: 14px; line-height: 1.6; background: #f7f7f7; border-radius: 8px; box-shadow: 0 2px 8px #0001;">
<div style="font-size:24px; font-weight:bold; margin-bottom:10px; color:#222; text-align:center;">${cvData.nombre}</div>

<div style="margin-bottom:20px; padding:15px; background:#fff; border-radius:6px;">
<div style="font-size:16px; font-weight:bold; color:#444; margin-bottom:8px;">${cvData.subtitulo}</div>
<div style="color:#333; white-space:pre-line;">${cvData.prologo}</div>
</div>


<div style="margin-bottom:20px; padding:15px; background:#fff; border-radius:6px;">
<div style="font-size:16px; font-weight:bold; color:#444; margin-bottom:8px;">${cvData.formacion.titulo}</div>
<div style="color:#333; white-space:pre-line; margin-bottom:10px;">${cvData.formacion.descripcion}</div>
<div style="color:#666; font-style:italic;">Certificaciones: ${cvData.formacion.certificaciones}</div>
</div>

<div style="margin-bottom:20px, padding:15px; background:#fff; border-radius:6px;">
<div style="font-size:16px; font-weight:bold; color:#444; margin-bottom:10px;">${cvData.experiencia.titulo}</div>
<ul style="margin:0; padding-left:20px;">
${experienciaHTML}
</ul>
</div>

<div style="margin-bottom:20px; padding:15px; background:#fff; border-radius:6px;">
<div style="font-size:16px; font-weight:bold; color:#444; margin-bottom:8px;">${cvData.habilidades.titulo}</div>
<div style="margin-bottom:8px;"><strong>Lenguajes:</strong> ${cvData.habilidades.lenguajes}</div>
<div style="margin-bottom:8px;"><strong>Plataformas:</strong> ${cvData.habilidades.plataformas}</div>
<div style="margin-bottom:8px;"><strong>Herramientas:</strong> ${cvData.habilidades.herramientas}</div>
<div><strong>Idiomas:</strong> ${cvData.habilidades.idiomas}</div>
</div>

<div style="margin-bottom:20px; padding:15px; background:#fff; border-radius:6px;">
<div style="font-size:16px; font-weight:bold; color:#444; margin-bottom:8px;">${cvData.personal.titulo}</div>
<div style="margin-bottom:8px;"><strong>Deportes:</strong> ${cvData.personal.deportes}</div>
<div style="margin-bottom:8px;"><strong>Música:</strong> ${cvData.personal.musica}</div>
<div style="margin-bottom:10px;"><strong>Viajes:</strong> ${cvData.personal.viajes}</div>
<div style="margin-bottom:8px;"><strong>Curiosidades y Manías</strong></div>
<ul style="margin:0; padding-left:20px; font-size:13px;">
${curiosidadesHTML}
</ul>
</div>

<div style="margin-bottom:20px; padding:15px; background:#fff; border-radius:6px;">
<div style="font-size:16px; font-weight:bold; color:#444; margin-bottom:8px;">Epílogo: Qué Busco y Qué Ofrezco</div>
<div style="margin-bottom:8px;"><strong>Busco:</strong> ${cvData.epilogo.busco}</div>
<div style="margin-bottom:8px;"><strong>Ofrezco:</strong> ${cvData.epilogo.ofrezco}</div>
<div style="margin-bottom:8px;"><strong>Garantía:</strong> ${cvData.epilogo.garantia}</div>
<div style="font-style:italic; color:#666; margin-top:10px;">${cvData.epilogo.contacto_final}</div>
</div>
</div>`;
  }

  let topZIndex = 20; // z-index inicial para ventanas

  function bringToFront(win) {
    topZIndex++;
    win.style.zIndex = topZIndex;
    // Sin efectos visuales, solo cambio de z-index
  }

  // Abrir ventanas simuladas
  window.openWindow = async function(type) {
    // No ocultar ninguna ventana, solo abrir la nueva o mostrar la existente
    if (type === 'chat') {
      const chatWin = document.getElementById('chat-window');
      chatWin.style.display = 'block';
      bringToFront(chatWin);
      return;
    }
    let win = document.getElementById(type + '-window');
    if (!win) {
      win = document.createElement('div');
      win.className = 'mac-window';
      win.id = type + '-window';
      // Posición aleatoria
      const randTop = Math.floor(Math.random() * 40) + 40; // entre 40px y 80px
      const randLeft = Math.floor(Math.random() * (window.innerWidth - 500)) + 40; // entre 40px y ancho-500
  win.style.top = randTop + 'px';
  win.style.left = randLeft + 'px';
  win.style.width = '700px';
  win.style.transform = '';
      let title = '';
      let content = '';
  if (type === 'cv') {
    title = 'CV';
    content = await generateCVContent();
  } else if (type === 'proyectos') {
        title = 'Proyectos';
        content = '<div style="padding:16px;">Aquí se mostrarán los proyectos.<br><br><a href="https://github.com/juanulisespv" target="_blank">Ver proyectos en GitHub</a></div>';
      } else if (type === 'contacto') {
        title = 'Contacto';
        content = '<div style="padding:16px;">Puedes contactar a Uli en:<br><br><a href="mailto:uli@email.com">uli@email.com</a></div>';
      }
      win.innerHTML = `
        <div class="mac-titlebar">
          <div class="mac-buttons">
            <div class="mac-btn close" title="Cerrar"></div>
            <div class="mac-btn min" title="Minimizar"></div>
            <div class="mac-btn max" title="Maximizar"></div>
          </div>
          <div class="mac-title">${title}</div>
        </div>
        <div class="mac-content">${content}</div>
      `;
      document.body.appendChild(win);
      bringToFront(win);
      // Añadir funcionalidad a los botones de la ventana nueva
      const closeBtn = win.querySelector('.mac-btn.close');
      const maxBtn = win.querySelector('.mac-btn.max');
      const minBtn = win.querySelector('.mac-btn.min');
      let maximized = false;
      let minimized = false;
      if (closeBtn) {
        closeBtn.addEventListener('click', function(e) {
          win.style.display = 'none';
        });
      }
      if (maxBtn) {
        maxBtn.addEventListener('click', function(e) {
          const content = win.querySelector('.mac-content');
          if (!maximized) {
            win.style.width = '90vw';
            win.style.height = '90vh';
            win.style.top = '5vh';
            win.style.left = '50%';
            win.style.transform = 'translateX(-50%)';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            win.style.boxShadow = '4px 4px 0 #888';
            if (content) content.style.display = '';
            maximized = true;
          } else {
            win.style.width = '';
            win.style.height = '';
            win.style.top = randTop + 'px';
            win.style.left = randLeft + 'px';
            win.style.transform = '';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            win.style.boxShadow = '4px 4px 0 #888';
            if (content) content.style.display = '';
            maximized = false;
          }
        });
      }
      if (minBtn) {
        minBtn.addEventListener('click', function(e) {
          const content = win.querySelector('.mac-content');
          const titlebar = win.querySelector('.mac-titlebar');
          if (!minimized) {
            if (content) content.style.display = 'none';
            win.style.height = (titlebar.offsetHeight + 4) + 'px';
            win.style.width = (titlebar.offsetWidth + 8) + 'px';
            win.style.background = 'transparent';
            win.style.border = 'none';
            win.style.borderRadius = '6px';
            win.style.boxShadow = 'none';
            minimized = true;
          } else {
            if (content) content.style.display = '';
            win.style.height = '';
            win.style.width = '';
            win.style.background = '#fff';
            win.style.border = '2px solid #000';
            win.style.borderRadius = '6px 6px 0 0';
            win.style.boxShadow = '4px 4px 0 #888';
            minimized = false;
          }
        });
      }
      makeWindowDraggable(win);
    }
    win.style.display = 'block';
    bringToFront(win);
  };
  // Mostrar ventana de chat al inicio
  window.addEventListener('DOMContentLoaded', function() {
    openWindow('chat');
  });
  // Hacer la ventana movible y escalable
  // Hacer todas las ventanas movibles
  function makeWindowDraggable(win) {
    const bar = win.querySelector('.mac-titlebar');
    if (!bar) return;
    
    // Crear área de arrastre específica
    let dragHandle = bar.querySelector('.mac-drag-handle');
    if (!dragHandle) {
      dragHandle = document.createElement('div');
      dragHandle.className = 'mac-drag-handle';
      dragHandle.title = 'Arrastrar ventana';
      bar.appendChild(dragHandle);
    }
    
    let isDragging = false;
    let startX = 0, startY = 0;
    let startWinX = 0, startWinY = 0;
    
    function startDrag(e) {
      isDragging = true;
      
      // Obtener coordenadas del mouse o toque
      const clientX = e.clientX || (e.touches && e.touches[0].clientX);
      const clientY = e.clientY || (e.touches && e.touches[0].clientY);
      
      startX = clientX;
      startY = clientY;
      
      // Obtener posición real de la ventana
      const rect = win.getBoundingClientRect();
      startWinX = rect.left;
      startWinY = rect.top;
      
      win.style.transform = 'none';
      document.body.style.userSelect = 'none';
      document.body.style.cursor = 'move';
      e.preventDefault();
      e.stopPropagation();
    }
    
    function doDrag(e) {
      if (!isDragging) return;
      
      const clientX = e.clientX || (e.touches && e.touches[0].clientX);
      const clientY = e.clientY || (e.touches && e.touches[0].clientY);
      
      const deltaX = clientX - startX;
      const deltaY = clientY - startY;
      
      win.style.left = (startWinX + deltaX) + 'px';
      win.style.top = (startWinY + deltaY) + 'px';
      e.preventDefault();
    }
    
    function endDrag() {
      if (isDragging) {
        isDragging = false;
        document.body.style.userSelect = '';
        document.body.style.cursor = '';
      }
    }
    
    // Eventos para mouse
    dragHandle.addEventListener('mousedown', function() {
      bringToFront(win);
    });
    dragHandle.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', doDrag);
    document.addEventListener('mouseup', endDrag);
    
    // Eventos para táctil
    dragHandle.addEventListener('touchstart', function() {
      bringToFront(win);
    });
    dragHandle.addEventListener('touchstart', startDrag, { passive: false });
    document.addEventListener('touchmove', doDrag, { passive: false });
    document.addEventListener('touchend', endDrag);
  }

  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.mac-window').forEach(win => {
      makeWindowDraggable(win);
      // Llevar al frente al hacer clic/tap en cualquier parte de la ventana
      win.addEventListener('mousedown', function() {
        bringToFront(win);
      }, true);
      win.addEventListener('touchstart', function() {
        bringToFront(win);
      }, true);
    });
  });

  // Chat clásico Mac OS
  const chatForm = document.getElementById('chatForm');
  const chatInput = document.getElementById('chatInput');
  const chatContainer = document.getElementById('chatContainer');

  // Generar un sessionId único para esta sesión de chat
  const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

  // Mensaje inicial
  window.addEventListener('DOMContentLoaded', function() {
    addMessage('assistant', 'Hola, Soy Uli, experto en Marketing y Desarrollo Tecnológico, ¿cómo puedo ayudarte?');
  });

  chatForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    const pregunta = chatInput.value.trim();
    if (!pregunta) return;
    chatInput.value = '';
    // Mostrar pregunta en el chat
    addMessage('user', pregunta);
    
    // Mostrar indicador de "escribiendo..."
    const typingDiv = document.createElement('div');
    typingDiv.className = 'mac-msg assistant typing';
    typingDiv.textContent = 'Uli está escribiendo...';
    typingDiv.style.fontStyle = 'italic';
    typingDiv.style.opacity = '0.7';
    chatContainer.appendChild(typingDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
    
    try {
      // Enviar pregunta al backend con sessionId
      const res = await fetch('/api/consultar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pregunta, sessionId })
      });
      const data = await res.json();
      
      // 🔍 MOSTRAR PROMPT EN CONSOLA DEL NAVEGADOR PARA REFINAMIENTO
      if (data.debug) {
        console.log('\n' + '='.repeat(80));
        console.log('🤖 PROMPT ENVIADO A OPENAI:');
        console.log('='.repeat(80));
        console.log(data.debug.prompt);
        console.log('='.repeat(80));
        console.log('📊 ESTADÍSTICAS DEL PROMPT:');
        console.log(`- Caracteres: ${data.debug.promptLength}`);
        console.log(`- SessionId: ${data.debug.sessionId}`);
        console.log(`- Total mensajes: ${data.debug.totalMessages}`);
        console.log(`- Temperatura: ${data.debug.temperature}`);
        console.log(`- Max tokens: ${data.debug.maxTokens}`);
        console.log(`- Modelo: ${data.debug.model}`);
        console.log('='.repeat(80) + '\n');
      }
      
      // Remover indicador de "escribiendo..."
      chatContainer.removeChild(typingDiv);
      
      if (data.respuesta) {
        addMessage('assistant', data.respuesta);
      } else {
        addMessage('assistant', 'Error: No se obtuvo respuesta.');
      }
    } catch (error) {
      // Remover indicador de "escribiendo..."
      chatContainer.removeChild(typingDiv);
      addMessage('assistant', 'Error: No se pudo conectar con el servidor.');
    }
  });

  function addMessage(role, text) {
    const msgDiv = document.createElement('div');
    msgDiv.className = 'mac-msg ' + role;
    msgDiv.textContent = text;
    chatContainer.appendChild(msgDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }
  </script>
</body>
</html>
